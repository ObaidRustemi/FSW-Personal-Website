<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Rain on Glass – Desktop Tech Demo</title>
  <style>
    body { margin: 0; min-height: 200vh; color: #fff; font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background:
        linear-gradient(120deg, #0b1e39, #00152a 60%),
        url('https://images.unsplash.com/photo-1491553895911-0055eca6402d?q=80&w=1600&auto=format&fit=crop') center/cover no-repeat fixed;
    }
    img.bg { position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; }
    .hero { padding: 6rem 4rem; max-width: 60rem; }
    .overlay { position: fixed; inset: 0; background: rgba(12,14,16,0.35);
      backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); pointer-events: none; }
    .overlay.no-backdrop { backdrop-filter: none; -webkit-backdrop-filter: none; background: rgba(12,14,16,0.65);
      background-repeat: no-repeat; background-position: 0 0; background-size: cover; }
    #rainCanvas { position: absolute; inset: 0; pointer-events: none; display: block; }
    .toggle { position: fixed; right: 16px; bottom: 16px; z-index: 2; padding: 10px 14px; border-radius: 8px; border: 0;
      background: #3058ff; color: #fff; cursor: pointer; }
  </style>
</head>
<body>
  <img id="bgImage" class="bg" src="https://res.cloudinary.com/traveltripperweb/image/upload/c_fit,f_auto,h_1200,q_auto,w_1200/v1627681436/bgvlhnmlrwyhm2xwdock.jpg" crossorigin="anonymous" alt="Background" />

  <div class="hero">
    <h1>Rain on Glass – Desktop Tech Demo</h1>
    <p>Toggle the overlay. Look for sharper, slightly shifted background inside droplets (refraction), plus rim and streaks.</p>
  </div>

  <div class="overlay" id="overlay">
    <canvas id="rainCanvas"></canvas>
  </div>

  <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="rain-on-glass.js"></script>
  <script>
  (function(){
    const canvas = document.getElementById('rainCanvas');
    const bgImg = document.getElementById('bgImage');
    function size(){
      const dpr = Math.min(window.devicePixelRatio||1, 2);
      const W = Math.max(1, Math.floor(window.innerWidth));
      const H = Math.max(1, Math.floor(window.innerHeight));
      canvas.width = Math.round(W*dpr);
      canvas.height = Math.round(H*dpr);
      canvas.style.width = W+'px';
      canvas.style.height = H+'px';
    }
    window.addEventListener('resize', size);
    window.addEventListener('load', async () => {
      size();
      const rain = new RainOnGlass(canvas, {
        standalone: true,
        backgroundSource: '#bgImage',
        blur: 8,
        gravityDeg: 90,
        gravity: 0.6,
        collisions: true,
        smudge: true,
        fps: 60,
        maxDrops: 180,
        useMiniRefraction: true,
        miniBoost: true,
        condensation: true,
        condensationDensity: 0.2, // Reduced from 0.4
        condensationSize: 0.6,    // Reduced from 0.8
        condensationSparkle: 0.5, // Reduced from 0.7
        // Enhanced realistic physics
        enableTrails: true,
        dragCoeff: 0.8,
        windX: 0.1,  // Reduced wind
        windY: 0,
        adhesionBase: 0.95, // Increased stickiness
        slideThreshold: 8,
        terminalVelocity: 15
      });
      await rain.captureBackground();
      rain.start();
      window.__demo = rain;
      
      // Add debug functions to window for testing
      window.testRain = {
        getDropCount: () => rain.drops.length,
        getCondensationCount: () => rain.condensation.length,
        addDrop: (x, y, r) => rain.spawn(x, y, r),
        clearDrops: () => { rain.drops = []; rain.condensation = []; },
        restart: async () => {
          rain.stop();
          await rain.captureBackground();
          rain.start();
        },
        logState: () => {
          console.log('Rain State:', {
            drops: rain.drops.length,
            condensation: rain.condensation.length,
            running: rain.running,
            hasBackground: rain.hasBackground,
            enableTrails: rain.enableTrails,
            enableCondensation: rain.enableCondensation
          });
        }
      };
      
      console.log('Rain demo initialized. Use window.testRain for debugging.');
    });
  })();
  </script>
</body>
</html>

